<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

canvas.width = 900;
canvas.height = 600;

const scoreEl = document.getElementById("score");
const livesEl = document.getElementById("lives");

// IMAGENS
const playerImg = new Image();
playerImg.src = "playerShip1_red.png";

const enemyImg = new Image();
enemyImg.src = "enemyBlue1.png";

const laserPlayerImg = new Image();
laserPlayerImg.src = "laserRed06.png";

const laserEnemyImg = new Image();
laserEnemyImg.src = "laserBlue08.png";

// JOGADOR
const player = {
    x: canvas.width / 2 - 25,
    y: canvas.height - 80,
    width: 50,
    height: 50,
    speed: 6,
    lives: 3
};

// CONTROLES
const keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

// TIROS
let bullets = [];
let bulletCooldown = 0;

// INIMIGOS
let enemies = [];
let enemyBullets = [];
let enemySpawnTimer = 0;

// PROGRESSÃƒO DE DIFICULDADE ðŸ”¥
let difficulty = 1;
let spawnRate = 70;
let enemySpeed = 2;
let enemyShootChance = 0;

// SCORE
let score = 0;
let gameOver = false;

function shoot() {
    if (bulletCooldown <= 0) {
        bullets.push({
            x: player.x + player.width / 2 - 4,
            y: player.y,
            width: 8,
            height: 20,
            speed: 9
        });
        bulletCooldown = 14;
    }
}

function spawnEnemy() {
    enemies.push({
        x: Math.random() * (canvas.width - 40),
        y: -50,
        width: 40,
        height: 40,
        speed: enemySpeed,
        shootCooldown: Math.random() * 120
    });
}

function rectCollision(a, b) {
    return a.x < b.x + b.width &&
           a.x + a.width > b.x &&
           a.y < b.y + b.height &&
           a.y + a.height > b.y;
}

// LOOP
function update() {
    if (gameOver) return;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // MOVIMENTO
    if (keys["ArrowLeft"] && player.x > 0) player.x -= player.speed;
    if (keys["ArrowRight"] && player.x < canvas.width - player.width) player.x += player.speed;
    if (keys["ArrowUp"]) shoot();

    if (bulletCooldown > 0) bulletCooldown--;

    ctx.drawImage(playerImg, player.x, player.y, player.width, player.height);

    // TIROS JOGADOR
    bullets.forEach((b, i) => {
        b.y -= b.speed;
        ctx.drawImage(laserPlayerImg, b.x, b.y, b.width, b.height);
        if (b.y < 0) bullets.splice(i, 1);
    });

    // SPAWN INIMIGOS
    enemySpawnTimer++;
    if (enemySpawnTimer > spawnRate) {
        spawnEnemy();
        enemySpawnTimer = 0;
    }

    // INIMIGOS
    enemies.forEach((e, ei) => {
        e.y += e.speed;
        ctx.drawImage(enemyImg, e.x, e.y, e.width, e.height);

        // TIRO INIMIGO (sÃ³ depois de certo tempo)
        e.shootCooldown--;
        if (difficulty > 2 && e.shootCooldown <= 0 && Math.random() < enemyShootChance) {
            enemyBullets.push({
                x: e.x + e.width / 2 - 3,
                y: e.y + e.height,
                width: 6,
                height: 16,
                speed: 5
            });
            e.shootCooldown = 120;
        }

        // COLISÃƒO COM JOGADOR
        if (rectCollision(player, e)) {
            enemies.splice(ei, 1);
            player.lives--;
            livesEl.textContent = player.lives;
            if (player.lives <= 0) gameOver = true;
        }

        // COLISÃƒO COM TIROS
        bullets.forEach((b, bi) => {
            if (rectCollision(b, e)) {
                enemies.splice(ei, 1);
                bullets.splice(bi, 1);
                score += 10;
                scoreEl.textContent = score;
            }
        });

        if (e.y > canvas.height) enemies.splice(ei, 1);
    });

    // TIROS INIMIGOS
    enemyBullets.forEach((b, i) => {
        b.y += b.speed;
        ctx.drawImage(laserEnemyImg, b.x, b.y, b.width, b.height);

        if (rectCollision(player, b)) {
            enemyBullets.splice(i, 1);
            player.lives--;
            livesEl.textContent = player.lives;
            if (player.lives <= 0) gameOver = true;
        }

        if (b.y > canvas.height) enemyBullets.splice(i, 1);
    });

    // ðŸ”¥ AUMENTO DE DIFICULDADE
    if (score > difficulty * 100) {
        difficulty++;
        enemySpeed += 0.4;
        spawnRate = Math.max(25, spawnRate - 5);
        enemyShootChance += 0.03;
    }

    if (gameOver) {
        ctx.fillStyle = "red";
        ctx.font = "48px Arial";
        ctx.fillText("GAME OVER", canvas.width / 2 - 140, canvas.height / 2);
        ctx.font = "22px Arial";
        ctx.fillText("Pressione R para reiniciar", canvas.width / 2 - 150, canvas.height / 2 + 40);
    }

    requestAnimationFrame(update);
}

document.addEventListener("keydown", e => {
    if (e.key.toLowerCase() === "r" && gameOver) location.reload();
});

update();
</script>
